pico-8 cartridge // http://www.pico-8.com
version 21
__lua__

#include vector.p8

function random_one(set)
	return set[1 + flr(rnd(count(set)))]
end

function cc_collision(c1,c2)
	local distance = c1.pos - c2.pos
	return #distance <= c1.r+c2.r
end

function make_circle(o)
	return {
		pos = vector{o.x,o.y},
		x = o.x,
		y = o.y,
		r = o.r,
		col = o.col,
		inactive_col = o.col,
		dx = 0,
		dy = 0,
		ddx = 0.3,
		ddy = 0.3,
		dx_max = 2,
		dx_min = -2,
		dy_max = 2,
		dy_min = -2,
		friction = 0.1,
		update = function(self)
			if (o.update) then
				o.update(self)
			end
			self.dx = max(min(self.dx,self.dx_max),self.dx_min)
			self.dy = max(min(self.dy,self.dy_max),self.dy_min)
			
			self.x += self.dx
			self.y += self.dy
			self.pos = vector{self.x,self.y}
		end,
		draw = function(self)
			circfill(self.x,self.y,self.r,self.col)
			local half_r = flr(self.r / 2)
			
			-- mouth
			rectfill(self.x - half_r, self.y + 1, self.x + half_r, self.y + max(1, flr(self.r / 2)), 0)

			-- left whites
			rectfill(self.x - half_r, self.y - half_r, self.x - half_r + flr(self.r / 4), self.y - half_r + flr(self.r / 4), 7)
			-- right whites
			rectfill(self.x + half_r, self.y - half_r,self.x + half_r - flr(self.r / 4), self.y - half_r + flr(self.r / 4), 7)

			-- left blacks
			rectfill(self.x - half_r + flr(self.r / 4), self.y - half_r, self.x - half_r + flr(self.r / 4) + flr(self.r / 4), self.y - half_r + flr(self.r / 4), 0)
			-- right whites
			rectfill(self.x + half_r + flr(self.r / 4), self.y - half_r, self.x + half_r + flr(self.r / 4) - flr(self.r / 4), self.y - half_r + flr(self.r / 4), 0)			
		end
	}
end

player = make_circle({
	x = 10,
	y = 10,
	r = 2,
	col = 11,
	update = function(self)

		if (btn(4)) then
			self.ddx = 0.3
			self.ddy = 0.3
			self.dx_max = 4
			self.dx_min = -4
			self.dy_max = 4
			self.dy_min = -4
		else
			self.boosting = false
			self.ddx = 0.3
			self.ddy = 0.3
			self.dx_max = 2
			self.dx_min = -2
			self.dy_max = 2
			self.dy_min = -2
		end

		if (btn(0)) then
			self.dx -= self.ddx
		elseif (btn(1)) then
			self.dx += self.ddx
		else
			if (self.dx > 0) then
				self.dx -= self.friction
			else
				self.dx += self.friction
			end
			if (abs(self.dx) <= self.friction) then
				self.dx = 0
			end
		end
		
		if (btn(3)) then
			self.dy += self.ddy
		elseif (btn(2)) then
			self.dy -= self.ddy
		else
			if (self.dy > 0) then
				self.dy -= self.friction
			else
				self.dy += self.friction
			end
			if (abs(self.dy) <= self.friction) then
				self.dy = 0
			end
		end
	end
})

objects = {}
circles = {}
add(objects, player)

function make_random_circle()
	local colors = { 8, 9, 10, 14, 6, 13 }
	return make_circle({
		x = 128 - flr(rnd(256)),
		y = 128 - flr(rnd(256)),
		r = 3 + flr(rnd(7)),
		col =  random_one(colors)
	})
end

for i = 0, 40 do
	local circle = make_random_circle()
	add(objects, circle)
	add(circles, circle)
end

function _update60()
	for o in all(objects) do
		if (o.update) then
			o:update()
		end
	end

	for circle in all(circles) do
		if (cc_collision(player, circle)) then
			player.r += circle.r / 8
			del(circles, circle)
			del(objects, circle)
		end
	end
end

function draw_background()
	local x_start = flr(player.x / 16) - 4
	local y_start = flr(player.y / 16) - 4
	local start_x = player.x - 64
	local start_y = player.y - 64
	for x = x_start, x_start + 8 do
		for y = y_start, y_start + 8 do
			spr(0, x * 16, y * 16, 2, 2)
		end
	end
end

function _draw()
	cls(12)
	
	draw_background()
	
	local center_x = player.x - 64
	local center_y = player.y - 64
	camera(center_x, center_y)
	for o in all(objects) do
		if (o.draw) then
			o:draw()
		end
	end
end

__gfx__
30033300003000330088888888888888888888800000000000000999999999000000000000000000000000000000000000000000000000000000000000000000
33000330030003300088000088888880000888800aa0aa0aaa00099099909990000eee00eeee00eeee0066666000000000000000000000000000000000000000
03000033330003000080888808888808888088800aaa00aaaa00099909099999000eeeee0ee0eeeeee0070670000000000000000000000000000000000000000
03300000000033000088888880888088888888800700aa700a00070090997009000eeeeee00eeeeeee0066666000000000000000000000000000000000000000
00330000000030000088888888080888888888800700aa700a0007009999700900077000eeee77000e0060006000000000000000000000000000000000000000
00033000000030000088888888808888888888800aaaaaaaaa0009999999999900077000eeee77000e0066666000000000000000000000000000000000000000
30003300000330030088888888888888888888800aaaaaaaaa0009999999999900077000eeee77000e0000000000000000000000000000000000000000000000
33000330000300300077700000888877700000800aa07070aa00099999999999000eeeeeeeeeeeeeee0000000000000000000000000000000000000000000000
03300033003300300077700000888877700000800aaaaaaaaa00097070707999000eeeeeeeeeeeeeee0000000000000000000000000000000000000000000000
0033000033300330007770000088887770000080000000000000090000000999000eeeeeeeeeeeeeee0000000000000000000000000000000000000000000000
0003330000003300007770000088887770000080000000000000090707070999000ee0707070707eee0000000000000000000000000000000000000000000000
0000033300033000008888888888888888888880000000000000099999999990000e000000000000ee0000000000000000000000000000000000000000000000
3000000333330003008888888888888888888880000000000000000000000000000e000000000000ee0000000000000000000000000000000000000000000000
3300000000000333008888888888888888888880000000000000000000000000000e000000000000ee0000000000000000000000000000000000000000000000
0330000000003300008888888888888888888880000000000000000000000000000ee7070707070eee0000000000000000000000000000000000000000000000
0033000000033000008888888888888888888880000000000000000000000000000eeeeeeeeeeeeeee0000000000000000000000000000000000000000000000
00000000000000000088770077007700770888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000080770077007700770088800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000080000000000000000088800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000080000000000000000088800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000080000000000000000088800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000080000000000000000088800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000080007700770077000088800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000088007700770077000888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000088888888888888888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000008888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
00000000000000000000000008888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
00000000000000000000000008888888877777000000777777000000777777000000777777000000777777000000777777000000777777000000777788888888
00000000000000000000000008888888777777000000777777000000777777000000777777000000777777000000777777000000777777000000777777888888
00000000000000000000000008888880777777000000777777000000777777000000777777000000777777000000777777000000777777000000777777088888
00000000000000000000000008888800777777000000777777000000777777000000777777000000777777000000777777000000777777000000777777008888
00000000000000000000000008888000777777000000777777000000777777000000777777000000777777000000777777000000777777000000777777008888
00000000000000000000000008888000777777000000777777000000777777000000777777000000777777000000777777000000777777000000777777000888
00000000000000000000000008880000777777000000777777000000777777000000777777000000777777000000777777000000777777000000777777000888
00000000000000000000000008880000777777000000777777000000777777000000777777000000777777000000777777000000777777000000777777000888
00000000000000000000000008880000777777000000777777000000777777000000777777000000777777000000777777000000777777000000777777000888
00000000000000000000000008880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008000000077777000007770000000077700000777777000077700000000007770077700777000000000077700777777777700008
00000000000000000000000008000007777777700007770000000077700000777777770007770000000007770077700077700000000077700777777777700008
00000000000000000000000008000007770007770007770000000077700000770007777007770000000007770077700077700000000077700777000000000008
00000000000000000000000008000077700000700007770000000077700000770000077700777000000077700077700007770000000777000777000000000008
00000000000000000000000008000077700000000007770000000077700000770000077700777000000777000077700007770000007770000777000000000008
00000000000000000000000008000077777000000007770000000077700000770000077700077700000777000077700000777000007770000777000000000008
00000000000000000000000008000007777770000007770000000077700000770000777700077700000777000077700000777000007770000777777777700008
00000000000000000000000008000000777777700007770000000077700000770007777000007770007770000077700000077700077700000777777777700008
00000000000000000000000008000000077777770007770000000077700000777777770000007770007770000077700000077700077700000777000000000008
00000000000000000000000008000000000777770007770000000077700000777777700000007770077700000077700000077700777000000777000000000008
00000000000000000000000008000000000007777007770000000077700000770777000000000777077700000077700000007770777000000777000000000008
00000000000000000000000008000000000000777007770000000077700000770077700000000777077700000077700000007770777000000777000000000008
00000000000000000000000008000007000000777007770000000077700000770077770000000077777000000077700000000777770000000777000000000008
00000000000000000000000008000077700000770000777000000777000000770000777000000007770000000077700000000077700000000777000000000008
00000000000000000000000008000077770007770000077700007770000000770000777700000007770000000077700000000077700000000777000000000008
00000000000000000000000008000007777777700000007777777700000000770000077770000007700000000077700000000077000000000777777777700008
00000000000000000000000008000000777777000000000777777000000000770000007770000000700000000077700000000007000000000777777777700008
00000000000000000000000008000000000000000000000000000000000000000000000000000000700000000000000000000007000000000000000000000008
00000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
00000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
00000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
00000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
00000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
00000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
00000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
00000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088
00000000000000000000000008887777000000777777000007777770000007777770000007777770000007777770000007777770000077777700000077777788
00000000000000000000000008887777000000777777000007777770000007777770000007777770000007777770000007777770000077777700000077777888
00000000000000000000000008887777000000777777000007777770000007777770000007777770000007777770000007777770000077777700000077777888
00000000000000000000000008888777000000777777000007777770000007777770000007777770000007777770000007777770000077777700000077777888
00000000000000000000000008888777000000777777000007777770000007777770000007777770000007777770000007777770000077777700000077778888
00000000000000000000000008888877000000777777000007777770000007777770000007777770000007777770000007777770000077777700000077778888
00000000000000000000000008888887000000777777000007777770000007777770000007777770000007777770000007777770000077777700000077778888
00000000000000000000000008888888000000777777000007777770000007777770000007777770000007777770000007777770000077777700000077788888
00000000000000000000000008888888800000777777000007777770000007777770000007777770000007777770000007777770000077777700000077888888
00000000000000000000000008888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
00000000000000000000000008888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
00000000000000000000000008888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
00000000000000000000000008888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
00000000000000000000000008888800000888888888888888888888888888888888888000888888888888888880000088888888888888888888888888888888
00000000000000000000000008888808888888888888880088888888888888888888888088008888888888888880888888888888888008888888888888888888
00000000000000000000000008888808888888888888880088888888888888888888888088008888888888888880888888888888888008888888888888888888
00000000000000000000000008888800000888000008800008888880000880000088888088008888800888888880000088800000880000880088880000888888
00000000000000000000000008888808888880008008880088888800880080088888888000088888008088888880888888000800888008808808880088088888
00000000000000000000000008888808888880088008880088888008888000088888888088800880000008888880888888008800888008000000880088088888
00000000000000000000000008888808888880088008880088888008888000088888888088800880088888888880888888008800888008008888880088088888
00000000000000000000000008888808888880008008880088888800880080088888888088000888088008888880888888000800888008808800880088088888
00000000000000000000000008888800000888000008880088888880000880088888888000088888800088888880000088800000888008880008880088088888
00000000000000000000000008888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
00000000000000000000000008888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
